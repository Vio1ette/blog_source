

其他 IPC形式（管道、FIFO、消息队列）的通用问题是：进程之间交换信息是，数据流必须经过内核，就要进行用户态和内核态的切换、内核和用户进程之间的数据复制，会造成额外的开销。而共享内存可以绕过内核，直接对<u>共享内存区</u>进行读写，但是进程在访问共享内存的时候必须要考虑<u>同步</u>问题

![4ED4A595F06036CBEE114CBC6EE61FA4](https://raw.githubusercontent.com/Vio1ette/blog-img/main/4ED4A595F06036CBEE114CBC6EE61FA4.png)

### 2. 共享内存的实现方式

#### 2.1 mmap（内存映射文件）

磁盘中的一个文件可以映射到进程的虚拟内存上，然后进程访问自己的虚拟内存上的这块映射区，对其进行读写，其实是对磁盘文件进行了读写，但是这里对磁盘文件进行读写竟然不用系统调用，不用转换状态（用户态->内核态），因为在进程看来，自己只不过是在访问自己的内存地址空间而已

![img](https://raw.githubusercontent.com/Vio1ette/blog-img/main/20200917180729.png)

> 磁盘文件映射虚拟内存，虚拟内存映射物理内存，实际上就是磁盘文件映射物理内存！

#### 2.2 System V共享内存

在<u>物理内存</u>上创建一块共享内存区，不同进程将自己的一块虚拟内存通过页表映射到同一块物理内存

![img](https://raw.githubusercontent.com/Vio1ette/blog-img/main/20200917180539.png)



参考资料：

（1）https://cana.space/%E5%85%B1%E4%BA%AB%E5%86%85%E5%AD%98%E4%B8%8E%E5%86%85%E5%AD%98%E6%98%A0%E5%B0%84/

（2）《unix网络编程-卷2，进程间通信》
