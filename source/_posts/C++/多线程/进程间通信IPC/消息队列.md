这里只将System V消息队列，因为其使用更广

在内核中维护一个链表，每个节点都是一个消息，每个消息的属性有：

1. 优先级（long 类型System V）

2. 消息数据部分长度（可用来识别消息边界）
3. 实际数据

![image-20220429112312157](https://raw.githubusercontent.com/Vio1ette/blog-img/main/image-20220429112312157.png)

具有足够写权限的线程可向链表中放置消息并设置其优先级，有足够读权限的线程可从链表中取出消息。一个进程向链表中添加节点（消息）时，并不要求另一个进程在等待此消息，但管道要求读、写者同时存在。

链表头节点中有整个队列的属性：队列中允许的最大消息数，每个消息的最大大小等

System V消息队列存放在内核中（下图中），且具有内核持续性，即使进程被关闭了，消息队列仍然存在于内核中

> 内核持续性，IPC对象一直存在直到内核重新自举或显示删除该对象为止

![image-20220428211142434](https://raw.githubusercontent.com/Vio1ette/blog-img/main/image-20220428211142434.png)
